<html>
<head>
<meta charset="utf8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css">
<title>订单</title>
<style>
.itemImg {
	width: 200px;
}
</style>
</head>
<body class="container">

	<table class="table">
		<thead class="thead-dark">
			<tr>
				<th scope="col">买家</th>
				<th scope="col">卖家</th>
				<th scope="col">地址</th>
				<th scope="col">状态</th>
				<th scope="col"> </th>
			</tr>
		</thead>
		<tbody id="tableBody">
			
		</tbody>
	</table>
	<ul class="list-group" id="ulItemList">
		
	
	</ul>

	<div class="d-flex justify-content-between" style="margin: 2% 0 10%;">
		<button type="button" class="btn btn-light" style="width: 25%;"
			onclick="previousPage();">上一页</button>
		<button type="button" class="btn btn-primary" style="width: 50%;"
			onclick="nextPage();">下一页</button>
	</div>

	<script type="text/javascript" src="../js/jquery.min.js"></script>
	<script type="text/javascript" src="../js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../js/popper.min.js"></script>
	
	<table style="display:none;">
		<tbody>
			<tr id="trItemTemplate">
				<td class="buyerId"></td>
				<td class="sellerId"></td>
				<td class="address"></td>
				<td class="status"></td>
			</tr>
		</tbody>
	</table>
	<ul style="display:none;">
	<li class="list-group-item" id="liItemTemplate" style="display:none;">
		<div class="d-flex flex-row">
		 <div>
		 	<img class="itemImg" src="/goodimgs/00f41d9a-a633-4310-897a-f8d3e9491fe6.jpg">
		 </div>
		 <div class="itemInfo flex-grow-1 d-flex flex-column">
		 	<h3 class="itemTitle">标题</h3>
		 	<p  class="itemDescription flex-grow-1">描述</p>
		 	<div>
		 		库存：<span class="itemNumber font-weight-light"></span>个
		 		<br/>
		 		价格：<span class="itemPrice font-weight-bold"></span>元
		 	</div>
		 </div>
		</div>
	</li>
	</ul>

	<script>
		const STATUS={
				"paid":"已付款",
				"send":"已发货",
				"finished":"已完成"
		};
		tableBody = $("#tableBody");
		itemList = $("#ulItemList");
		function addItemGood(item){
			let newItem = $("#liItemTemplate").clone();
			newItem.css("display", "");
			
			newItem.attr("data-id", item.id);
			newItem.find(".itemImg").attr("src", "/goodimgs/"+item.img);
			newItem.find(".itemTitle").text(item.title);
			newItem.find(".itemDescription").text(item.description);
			newItem.find(".itemPrice").text(item.price);
			newItem.find(".itemNumber").text(item.number);

			itemList.append(newItem);
		}
		
		function addItemToList(item){
			let newItem = $("#trItemTemplate").clone();
			newItem.css("display", "");
			newItem.attr("id", "");
			newItem.attr("data-id", item.id);
			newItem.find(".buyerId").text(item.buyerId);
			newItem.find(".sellerId").text(item.sellerId);
			newItem.find(".address").text(item.address);
			newItem.find(".status").text(STATUS[item.status]);

			tableBody.append(newItem);
		}
		
		function getPage(page=1, search_string=""){
			tableBody.empty();
			itemList.empty();
			let search = location.search;
			$.ajax({
				'url':'/order-detail'+search,
				type : "GET",
		        contentType:'application/json;charset=UTF-8',    
				success : function(result){
					console.log(result);
					if(result.success){
						addItemToList(result.data.order);
						for(let g of result.data.goods){
							addItemGood(g);
						}
					}else{
						alert("请先登录");
					}
				}
			});
		}
		
		curPageNumber = 1;
		getPage(curPageNumber);
		
		function nextPage(){
			curPageNumber += 1;
			getPage(curPageNumber);
		}
		function previousPage(){
			if(curPageNumber > 1){
				curPageNumber--;
				getPage(curPageNumber);
			}else{
				alert("前面没有了");
			}
		}
	</script>
</body>
</html>